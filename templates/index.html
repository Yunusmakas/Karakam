<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARAKAM AI-MAP</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="/static/style.css?v=3">
    <link rel="icon" type="image/png" href="/static/karakam_logo.png">
</head>

<body>
    <div class="bg-overlay"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <img src="/static/karakam_logo.png" alt="KARAKAM AI-MAP" style="height: 120px;">
            </div>
            <p class="subtitle">KARAKAM AI Based Next-Gen Malware Analysis Powered by MobSF, VirusTotal, JADX &
                Subfinder
            </p>
        </header>

        <!-- Main Grid -->
        <div class="main-grid">

            <!-- Top Dashboard: 3 Columns -->
            <div class="top-dashboard">

                <!-- 1. Configuration Card -->
                <div class="card config-card">
                    <div class="card-header">
                        <i class="uil uil-cog"></i>
                        <h3>Configuration</h3>
                    </div>
                    <div class="card-body">
                        <div class="input-group">
                            <label>MobSF API Key</label>
                            <input type="password" id="mobsf-key" placeholder="Enter MobSF API Key" value="">
                        </div>
                        <div class="input-group">
                            <label>VirusTotal API Key</label>
                            <input type="password" id="vt-key" placeholder="Enter VirusTotal API Key" value="">
                        </div>

                        <div class="divider"></div>

                        <div class="input-group">
                            <label>AI Model Provider</label>
                            <select id="llm-provider" onchange="toggleLLMFields()">
                                <option value="gemini">Google Gemini (Cloud)</option>
                                <option value="ollama">Ollama (Local)</option>
                                <option value="karakam">KARAKAM.ai (Fine-Tuned)</option>
                            </select>
                        </div>

                        <div id="gemini-fields">
                            <div class="input-group">
                                <label>Gemini API Key</label>
                                <input type="password" id="gemini-key" placeholder="Enter Gemini API Key" value="">
                            </div>
                        </div>

                        <div id="ollama-fields" style="display: none;">
                            <div class="input-group">
                                <label>Ollama Model Name</label>
                                <input type="text" id="ollama-model" value="ollama3.1:8b"
                                    placeholder="e.g. ollama3.1:8b, mistral">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Upload Card -->
                <div class="card upload-card">
                    <div class="card-header">
                        <i class="uil uil-upload"></i>
                        <h3>Upload APK</h3>
                    </div>
                    <div class="upload-area" id="drop-zone">
                        <i class="uil uil-cloud-upload"></i>
                        <p>Drag & Drop APK file here</p>
                        <span>or</span>
                        <button class="btn-primary" onclick="document.getElementById('file-input').click()">Browse
                            Files</button>
                        <input type="file" id="file-input" hidden accept=".apk" multiple>
                    </div>
                    <div id="file-info" class="file-info hidden">
                        <i class="uil uil-file-alt"></i>
                        <span id="filename">app.apk</span>
                        <i class="uil uil-times remove-file" onclick="clearFile()"></i>
                    </div>
                    <button id="analyze-btn" class="btn-analyze" disabled onclick="startAnalysis()">
                        <i class="uil uil-search-alt"></i> Start Analysis
                    </button>
                </div>

                <!-- 3. Sponsors & Credits Card -->
                <div class="card credits-card">
                    <div class="card-header">
                        <i class="uil uil-award"></i>
                        <h3>Project Credits & Sponsors</h3>
                    </div>
                    <div class="card-body">
                        <div class="sponsors-list">
                            <div class="sponsor-item">
                                <div class="sponsor-info">
                                    <i class="uil uil-android"></i>
                                    <strong>AndroZoo</strong>
                                </div>
                                <span class="badge-sponsored">Premium Dataset Provider</span>
                            </div>
                            <div class="sponsor-item">
                                <div class="sponsor-info">
                                    <i class="uil uil-shield-check"></i>
                                    <strong>VirusTotal</strong>
                                </div>
                                <span class="badge-sponsored">Premium API Provider</span>
                            </div>
                            <div class="sponsor-item">
                                <div class="sponsor-info">
                                    <i class="uil uil-mobile-android"></i>
                                    <strong>MobSF</strong>
                                </div>
                                <span class="badge">Static Analyzer</span>
                            </div>
                            <div class="sponsor-item">
                                <div class="sponsor-info">
                                    <i class="uil uil-brackets-curly"></i>
                                    <strong>JADX</strong>
                                </div>
                                <span class="badge">Decompiler</span>
                            </div>
                            <div class="sponsor-item">
                                <div class="sponsor-info">
                                    <i class="uil uil-search"></i>
                                    <strong>Subfinder</strong>
                                </div>
                                <span class="badge">Subdomain Scanner</span>
                            </div>
                        </div>
                        <hr class="dim-divider">
                        <div class="team-section">
                            <h4>Developed By</h4>
                            <div class="team-list">
                                <a href="https://www.linkedin.com/in/tolga-demirel/" target="_blank">Tolga DEMİREL</a>
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">under the supervision
                                    of</span>
                                <a href="https://tr.linkedin.com/in/ibrahim-alper-do%C4%9Fru-96871560"
                                    target="_blank">Prof. Dr. İbrahim Alper DOĞRU</a>
                                <span style="font-size: 0.85rem; color: var(--text-secondary);">&</span>
                                <a href="https://tr.linkedin.com/in/kazim-kili%C3%A7-21580791" target="_blank">Dr. Kazım
                                    KILIÇ</a>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Bottom Panel: Results -->
            <div class="bottom-panel">

                <div class="bulk-layout">
                    <!-- Sidebar -->
                    <div class="sidebar hidden" id="task-sidebar">
                        <div class="sidebar-header">
                            <div>
                                <h4>Queue</h4>
                                <span id="queue-count" class="badge">0</span>
                            </div>
                            <button onclick="downloadReport()" title="Download Excel Report"
                                style="background:none; border:none; color:var(--text-primary); cursor:pointer; font-weight:600; margin-right: 10px;">
                                <i class="uil uil-file-download-alt"></i> Export
                            </button>
                            <button onclick="resetApp()"
                                style="background:none; border:none; color:var(--accent); cursor:pointer; font-weight:600;">
                                <i class="uil uil-plus"></i> New
                            </button>
                        </div>
                        <ul class="task-list" id="task-list">
                            <!-- Task items will be injected here -->
                        </ul>
                    </div>

                    <!-- Detail View -->
                    <div class="result-details">

                        <!-- Progress State -->
                        <div id="progress-container" class="card status-card hidden">
                            <h3>Analysis in Progress for <span id="current-analyzing-file">...</span></h3>
                            <div class="steps">
                                <div class="step active" id="step-1">
                                    <div class="circle"><i class="uil uil-upload"></i></div>
                                    <span>Uploading</span>
                                </div>
                                <div class="line"></div>
                                <div class="step" id="step-2">
                                    <div class="circle"><i class="uil uil-bug"></i></div>
                                    <span>MobSF Scan</span>
                                </div>
                                <div class="line"></div>
                                <div class="step" id="step-3">
                                    <div class="circle"><i class="uil uil-crosshair"></i></div>
                                    <span>Subfinder</span>
                                </div>
                                <div class="line"></div>
                                <div class="step" id="step-4">
                                    <div class="circle"><i class="uil uil-shield"></i></div>
                                    <span>VirusTotal</span>
                                </div>
                                <div class="line"></div>
                                <div class="step" id="step-5">
                                    <div class="circle"><i class="uil uil-brain"></i></div>
                                    <span>AI Analysis</span>
                                </div>
                            </div>
                            <p id="status-text" class="status-text">Initializing...</p>
                        </div>

                        <!-- Results State -->
                        <div id="result-container" class="card result-card hidden">
                            <div class="result-header-bar">
                                <h3 id="result-filename">Filename.apk</h3>
                                <span id="result-timestamp" class="timestamp">Just now</span>
                            </div>

                            <div id="verdict-banner" class="verdict-banner unknown">
                                <span id="verdict-label">PENDING</span>
                            </div>

                            <div class="tabs">
                                <button class="tab active" onclick="switchTab('ai')">AI Insights</button>
                                <button class="tab" onclick="switchTab('raw')">Raw Data</button>
                            </div>

                            <div id="tab-ai" class="tab-content active">
                                <div id="ai-output" class="markdown-body">
                                    <!-- AI Content -->
                                </div>
                            </div>

                            <div id="tab-raw" class="tab-content">
                                <pre id="raw-json"></pre>
                            </div>

                            <!-- Removed "Analyze Another" button from here as sidebar manages it -->
                        </div>

                        <!-- Empty State -->
                        <div id="empty-state" class="empty-state">
                            <img src="/static/karakam_logo.png" alt="Security" width="200"
                                style="border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                            <h3>Ready to Analyze</h3>
                            <p>Configure your API keys and select multiple APK files to begin the comprehensive malware
                                assessment.</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="/static/script.js?v=3"></script>
</body>

</html>